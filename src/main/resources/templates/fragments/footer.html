<html>

<body>
<div th:fragment="footerScript">
    <!--script src="../../js/bootstrap/jquery-3.3.1.slim.min.js"></script  NÃO TEM AJAX --> 
    <!-- então foi substituido por jquery-3.4.1.min.js --> 
    <script src="/webjars/jquery/3.4.1/jquery.min.js"></script>
    <script src="/webjars/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
    <script src="/webjars/bootstrap-select/1.4.2/bootstrap-select.min.js"></script>
    <script src="/js/custom/main.js"></script>
    <script src="/js/custom/utility.js"></script>
    <script src="/js/custom/handlers.js"></script>
</div>
<div th:fragment="customScript">
	<script>  
	//Não funciona a mesma funções no javascript handlers.js ??	
	$('.re-toggleSubMenu').on('hide.bs.collapse', function () {
		$(this).prev("a").removeClass("text-center font-weight-light display-4");  
		$(".alert").remove();
	});
	
	$('.re-toggleSubMenu').on('show.bs.collapse', function () {
	 	$(this).prev("a").addClass("text-center font-weight-light display-4");
	});
	
	var breadcrumbSession = {
			catalogName : "",
			projectName : "",
			codeName    : ""
			};

	var breacrumb_update = function () {
			  var $breadcrumb = $($('ol.breadcrumb')[0]);

			  //limpa breadcrumb
              $breadcrumb.empty();

			  if(breadcrumbSession.catalogName.length > 0){
			  	var $catalogitem = 
			          `<li class="breadcrumb-item"><a href="#">${breadcrumbSession.catalogName}</a></li>`;
				  $breadcrumb.append($catalogitem);
			  }
			  
			  if(breadcrumbSession.projectName.length > 0){
			    var $projectitem = 
			          `<li class="breadcrumb-item"><a href="#">${breadcrumbSession.projectName}</a></li>`;
				  $breadcrumb.append($projectitem);
			  }

			  if(breadcrumbSession.codeName.length > 0){
				    var $codeitem = 
				          `<li class="breadcrumb-item"><a href="#">${breadcrumbSession.codeName}</a></li>`;
					  $breadcrumb.append($codeitem);
			  }	

//			  console.log("vai chamar breacrumb_update_link() de breacrumb_update")
			  breacrumb_update_link();		  
	}

	/*
	   Atualiza link de chamada das páginas catalog.html, project.html e code.html
	   com query parameters do breadcrumbsession
	*/
	var breacrumb_update_link = function () {
			/*---------------------------------------------------------
			  if(breadcrumbSession.catalogName) testa if breadcrumbSession.catalogName
					null
					undefined
					NaN
					empty string ("")
					0
					false
			------------------------------------------------------------*/
		   if(!breadcrumbSession.catalogName){
//			   console.log("saindo de breacrumb_update_link, nada em breadcrumb ")
			return;
			   }
		   
//			console.log("entrando em breacrumb_update_link()");
//			console.log("breadcrumbSession.catalogName: " + breadcrumbSession.catalogName );
//			console.log("breadcrumbSession.projectName: " + breadcrumbSession.projectName );
			
		  var menu_links = $('a.re-breadcrumb-link');

//		  console.log("catalog link: " + menu_links[0])
//		  console.log("project link: " + menu_links[1])

		  for (var i = 0; i < menu_links.length; i++) {
//			  console.log("link antes: " + (menu_links[i]));

			  var str = menu_links[i].getAttribute("href");
//			  console.log(str);
			  var patt = /[^?]+/i;
			  var result = str.match(patt);

			  var queryParam = "";
			  
			  if(breadcrumbSession.catalogName){
				  queryParam = "?catname=" + breadcrumbSession.catalogName;
			  }

			  if(breadcrumbSession.projectName){
				  queryParam = queryParam + "&projname=" + breadcrumbSession.projectName;
			  }

			  menu_links[i].setAttribute("href", result + queryParam);
			  
//			  console.log("link depois: " + (menu_links[i]));
		  }
	}
	  

	$('tr.re-breadcrumb').on('click', function () {
		if($(this).find('.re-catname').length > 0){
			breadcrumbSession.catalogName = $(this).find('.re-catname')[0].innerHTML;
			}

		if($(this).find('.re-projname').length > 0){
			breadcrumbSession.projectName = $(this).find('.re-projname')[0].innerHTML;
			}

		if($(this).find('.re-codename').length > 0){
			breadcrumbSession.codeName = $(this).find('.re-codename')[0].innerHTML;
			}

//		console.log("vai chamar breacrumb_update() de clique tabela")
		breacrumb_update();
	});				  
</script>

<script th:inline="javascript">
//------------------------------------------------------
// referência: https://attacomsian.com/blog/thymeleaf-set-javascript-variable
//------------------------------------------------------
breadcrumbSession.catalogName = /*[[${@breadCrumbSession.getCatalogNameAndClear()}]]*/ "CATALOGXXX";
    breadcrumbSession.projectName = /*[[${@breadCrumbSession.getProjectNameAndClear()}]]*/ "PROJECTXXX";
    breadcrumbSession.codeName    = /*[[${@breadCrumbSession.getCodeNameAndClear()}]]*/ "CODEXXX";

//    console.log("vai chamar breacrumb_update() thymeleaf script");
    breacrumb_update();
    </script>
</div>
</body>
</html>